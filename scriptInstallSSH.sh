#!/bin/bash 

echo "
*************************************************************************************
*************************************************************************************
********************************Test de la config reseau sur www.google.fr***********
*************************************************************************************
*************************************************************************************
"
ping -c 3 www.google.fr > /dev/null

if [[ $? -eq 0 ]]; then
    echo "
*************************************************************************************
********************************Config reseau OK !***********************************
*************************************************************************************
"
else
    echo "
*************************************************************************************
********************************Erreur dans la config reseau*************************
*************************************************************************************
"
    exit 1
fi


echo "
*************************************************************************************
*************************************************************************************
********************************Desinstallation de OpenSSH Server********************
*************************************************************************************
*************************************************************************************
"

apt purge -y openssh-server


echo "
*************************************************************************************
*************************************************************************************
********************************Installation de OpenSSH Server***********************
*************************************************************************************
*************************************************************************************
"

apt update -y > /dev/null

apt install -y openssh-server

sed -i '/^#MaxAuthTries/ c\MaxAuthTries 1' /etc/ssh/sshd_config
sed -i '/^#Port/ c\Port 2223' /etc/ssh/sshd_config
sed -i '/^#LoginGraceTime/ c\LoginGraceTime 10' /etc/ssh/sshd_config


systemctl restart sshd
if [[ $? -eq 0 ]]; then
    echo "
*************************************************************************************
*************************************************************************************
********************************Installation reussite********************************
*************************************************************************************
*************************************************************************************

******************************************************
Connectez-vous à cette IP sur le poste client : ******
******************************************************

$(ip a)

*************************************
Le numéro de port est le 2223 *******
*************************************

"
else
    echo "
*************************************************************************************
*************************************************************************************
********************************Erreur lors de l'installation************************
*************************************************************************************
*************************************************************************************
"
fi
